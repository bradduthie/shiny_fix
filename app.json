[{"name":"server.R","content":"library(shiny);\nlibrary(DT); \nlibrary(shinyjs) \nlibrary(downloadthis)\n\nserver <- function(input, output, session) {\n  \n  fix_dataset <- function(dat){\n    mpans   <- unique(dat[,4])\n    N_mpans <- length(mpans)\n    combs   <- unique(x = cbind(dat[,4], dat[,11]))\n    keep    <- NULL\n    for(i in 1:N_mpans){\n      rel_emails <- which(combs[,1] == mpans[i])\n      email_numb <- length(rel_emails)\n      if(email_numb == 1){\n        keep    <- c(keep, rel_emails)\n      }else{\n        having  <- which(combs[,1] == mpans[i] & combs[,2] != \"\")\n        keep    <- c(keep, having)\n      }\n    }\n    new_dat <- combs[keep, ]\n    new_len <- dim(new_dat)[1]\n    rev_dat <- array(data = NA, dim = c(new_len, 11))\n    for(i in 1:new_len){\n      mpan     <- new_dat[i, 1]\n      email    <- new_dat[i, 2]\n      orig_row <- which(dat[,4] == mpan & dat[,11] == email)[1]\n      for(j in 1:11){\n        rev_dat[i, j] <- dat[orig_row, j]\n      }\n    }\n    return(rev_dat)\n  }\n  \n  # Reactive values\n  data <- reactiveValues(\n    original = NULL,\n    fixed = NULL\n  )\n  \n  # Observe file upload\n  observeEvent(input$file, {\n    req(input$file)\n    tryCatch({\n      df <- read.csv(input$file$datapath)\n      data$original <- df\n      data$fixed <- NULL\n    }, error = function(e) {\n      showNotification(paste(\"Error:\", e$message), type = \"error\")\n    })\n  })\n  \n  # Display original data\n  output$originalTable <- renderTable({\n    req(data$original)\n    head(data$original, 10)\n  })\n  \n  # Process data\n  observeEvent(input$process, {\n    req(data$original)\n    \n    tryCatch({\n      data_matrix <- as.matrix(data$original)\n      fixed_matrix <- fix_dataset(data_matrix)\n      fixed_df <- as.data.frame(fixed_matrix)\n      colnames(fixed_df) <- colnames(data$original)\n      data$fixed <- fixed_df\n      showNotification(\"Data processed successfully!\", type = \"message\")\n    }, error = function(e) {\n      showNotification(paste(\"Error:\", e$message), type = \"error\")\n    })\n  })\n  \n  # Display fixed data\n  output$fixedTable <- renderTable({\n    req(data$fixed)\n    head(data$fixed, 10)\n  })\n  \n  # Dynamic download button\n  output$downloadUI <- renderUI({\n    req(data$fixed)\n    \n    # Generate filename\n    filename <- if (!is.null(input$file)) {\n      paste0(tools::file_path_sans_ext(input$file$name), \"_fixed.csv\")\n    } else {\n      \"fixed_data.csv\"\n    }\n    \n    # Use download_this from the downloadthis package\n    download_this(\n      .data = data$fixed,\n      output_name = filename,\n      output_extension = \".csv\",\n      button_label = \"Download Fixed Data\",\n      button_type = \"success\",\n      has_icon = TRUE,\n      icon = \"fa fa-save\"\n    )\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n","type":"text"},{"name":"ui.R","content":"library(shiny)\nlibrary(DT); \nlibrary(shinyjs) \nlibrary(downloadthis)\n\nui <- fluidPage(\n  useShinyjs(),\n  titlePanel(\"Dataset Fixer - Working Download\"),\n  sidebarLayout(\n    sidebarPanel(\n      fileInput(\"file\", \"Upload CSV File\", accept = c(\".csv\")),\n      actionButton(\"process\", \"Process Data\", class = \"btn-primary\"),\n      br(), br(),\n      uiOutput(\"downloadUI\")\n    ),\n    mainPanel(\n      h4(\"Original Data (First 10 rows)\"),\n      tableOutput(\"originalTable\"),\n      h4(\"Fixed Data (First 10 rows)\"),\n      tableOutput(\"fixedTable\")\n    )\n  )\n)","type":"text"}]
