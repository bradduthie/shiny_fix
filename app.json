[{"name":"server.R","content":"library(shiny);\nlibrary(DT); \n\nserver <- function(input, output, session) {\n  \n  fix_dataset <- function(dat){\n    mpans   <- unique(dat[,4])\n    N_mpans <- length(mpans)\n    combs   <- unique(x = cbind(dat[,4], dat[,11]))\n    keep    <- NULL\n    for(i in 1:N_mpans){\n      rel_emails <- which(combs[,1] == mpans[i])\n      email_numb <- length(rel_emails)\n      if(email_numb == 1){\n        keep    <- c(keep, rel_emails)\n      }else{\n        having  <- which(combs[,1] == mpans[i] & combs[,2] != \"\")\n        keep    <- c(keep, having)\n      }\n    }\n    new_dat <- combs[keep, ]\n    new_len <- dim(new_dat)[1]\n    rev_dat <- array(data = NA, dim = c(new_len, 11))\n    for(i in 1:new_len){\n      mpan     <- new_dat[i, 1]\n      email    <- new_dat[i, 2]\n      orig_row <- which(dat[,4] == mpan & dat[,11] == email)[1]\n      for(j in 1:11){\n        rev_dat[i, j] <- dat[orig_row, j]\n      }\n    }\n    return(rev_dat)\n  }\n  \n  # Reactive values to store data\n  data <- reactiveValues(\n    original = NULL,\n    fixed = NULL\n  )\n  \n  # Observe file upload\n  observeEvent(input$file, {\n    req(input$file)\n    \n    tryCatch({\n      # Read the uploaded CSV file\n      df <- read.csv(input$file$datapath)\n      data$original <- df\n      data$fixed <- NULL  # Reset fixed data when new file is uploaded\n    }, error = function(e) {\n      showNotification(paste(\"Error:\", e$message), type = \"error\", duration = 10)\n    })\n  })\n  \n  # Display original data\n  output$originalTable <- renderDT({\n    req(data$original)\n    datatable(head(data$original, 10), options = list(scrollX = TRUE))\n  })\n  \n  # Process data when button is clicked\n  observeEvent(input$process, {\n    req(data$original)\n    \n    showModal(modalDialog(\"Processing data...\", footer = NULL))\n    \n    tryCatch({\n      # Convert data frame to matrix (as expected by fix_dataset)\n      data_matrix <- as.matrix(data$original)\n      \n      # Apply the fix_dataset function\n      fixed_matrix <- fix_dataset(data_matrix)\n      \n      # Convert back to data frame for display and download\n      fixed_df <- as.data.frame(fixed_matrix)\n      colnames(fixed_df) <- colnames(data$original)\n      \n      data$fixed <- fixed_df\n      \n      removeModal()\n      showNotification(\"Data processing completed successfully!\", type = \"message\")\n    }, error = function(e) {\n      removeModal()\n      showNotification(paste(\"Error processing data:\", e$message), type = \"error\", duration = 10)\n    })\n  })\n  \n  # Display fixed data\n  output$fixedTable <- renderDT({\n    req(data$fixed)\n    datatable(head(data$fixed, 10), options = list(scrollX = TRUE))\n  })\n  \n  # Dynamic download button (only appears after processing)\n  output$downloadUI <- renderUI({\n    req(data$fixed)\n    downloadButton(\"download\", \"Download Fixed Data\", class = \"btn-success\")\n  })\n  \n  # Download handler\n  output$download <- downloadHandler(\n    filename = function() {\n      name <- ifelse(is.null(input$file), \"fixed_data\", \n                     tools::file_path_sans_ext(input$file$name))\n      paste0(name, \"_fixed_\", format(Sys.Date(), \"%Y%m%d\"), \".csv\")\n    },\n    content = function(file) {\n      req(data$fixed)\n      write.csv(data$fixed, file, row.names = FALSE)\n    }\n  )\n}","type":"text"},{"name":"ui.R","content":"library(shiny)\n\nui <- fluidPage(\n  titlePanel(\"Dataset Fixer - Local Processing\"),\n  sidebarLayout(\n    sidebarPanel(\n      fileInput(\"file\", \"Upload CSV File\", accept = c(\".csv\", \".txt\")),\n      actionButton(\"process\", \"Process Data\", class = \"btn-primary\"),\n      br(), br(),\n      uiOutput(\"downloadUI\")  # Dynamic download button\n    ),\n    mainPanel(\n      h4(\"Original Data (First 10 rows)\"),\n      DTOutput(\"originalTable\"),\n      h4(\"Fixed Data (First 10 rows)\"),\n      DTOutput(\"fixedTable\")\n    )\n  )\n)","type":"text"}]
